/**
 * Service Worker для PWA
 * @package ATK_VED
 */
const CACHE_VERSION='atk-v1';const CACHE_STATIC='atk-static-v1';const CACHE_DYNAMIC='atk-dynamic-v1';const CACHE_IMAGES='atk-images-v1';const urlsToCache=['/wp-content/themes/atk-ved/css/variables.css','/wp-content/themes/atk-ved/css/base.css','/wp-content/themes/atk-ved/css/ui.css','/wp-content/themes/atk-ved/js/core.js','/wp-content/themes/atk-ved/js/ui.js','/manifest.json'];self.addEventListener('install',e=>{e.waitUntil(caches.open(CACHE_STATIC).then(cache=>cache.addAll(urlsToCache)).then(()=>self.skipWaiting()))});self.addEventListener('activate',e=>{e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(key=>key!==CACHE_STATIC&&key!==CACHE_DYNAMIC&&key!==CACHE_IMAGES).map(key=>caches.delete(key)))).then(()=>self.clients.claim()))});self.addEventListener('fetch',e=>{const{request}=e;const url=new URL(request.url);if(request.method!=='GET')return;if(url.pathname.match(/\.(jpg|jpeg|png|gif|webp|svg)$/i)){e.respondWith(caches.open(CACHE_IMAGES).then(cache=>cache.match(request).then(response=>response||fetch(request).then(fetchResponse=>{if(fetchResponse.ok){cache.put(request,fetchResponse.clone())}return fetchResponse}))))}else if(url.pathname.match(/\.(css|js|woff2?)$/i)){e.respondWith(caches.match(request).then(response=>response||fetch(request).then(fetchResponse=>{if(fetchResponse.ok){caches.open(CACHE_STATIC).then(cache=>cache.put(request,fetchResponse.clone()))}return fetchResponse})))}else{e.respondWith(fetch(request).then(response=>{if(response.ok&&!url.pathname.includes('/wp-admin/')){caches.open(CACHE_DYNAMIC).then(cache=>cache.put(request,response.clone()))}return response}).catch(()=>caches.match(request).then(response=>response||caches.match('/offline.html'))))}});self.addEventListener('message',e=>{if(e.data.action==='skipWaiting'){self.skipWaiting()}});
