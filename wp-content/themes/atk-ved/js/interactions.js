/**
 * Interactions - Модалки, слайдеры, галерея
 * @package ATK_VED
 */
(function($){'use strict';function initCallbackModal(){const floatButtonHTML='<button class="callback-float-btn" aria-label="Заказать обратный звонок"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg></button>';$('body').append(floatButtonHTML);const modalHTML='<div class="callback-modal-overlay"><div class="callback-modal"><div class="callback-modal-header"><button class="callback-modal-close" aria-label="Закрыть">&times;</button><h3>Заказать обратный звонок</h3><p>Оставьте свой номер и мы перезвоним вам в течение 15 минут</p></div><div class="callback-modal-body"><form class="callback-form" id="callbackForm"><div class="form-group"><label for="callback-name">Ваше имя *</label><input type="text" id="callback-name" name="name" placeholder="Иван" required><span class="error-message"></span></div><div class="form-group"><label for="callback-phone">Телефон *</label><input type="tel" id="callback-phone" name="phone" placeholder="+7 (___) ___-__-__" required><span class="error-message"></span></div><div class="form-group"><label for="callback-time">Удобное время для звонка</label><select id="callback-time" name="time"><option value="any">В любое время</option><option value="morning">Утро (9:00 - 12:00)</option><option value="afternoon">День (12:00 - 15:00)</option><option value="evening">Вечер (15:00 - 18:00)</option></select></div><div class="form-group"><label class="checkbox-label"><input type="checkbox" name="privacy" required><span>Согласен с политикой конфиденциальности *</span></label><span class="error-message"></span></div><button type="submit" class="submit-btn"><span class="button-text">Заказать звонок</span><span class="button-loader"></span></button></form></div></div></div>';$('body').append(modalHTML);$('.callback-float-btn').on('click',openCallbackModal);$('.callback-modal-close').on('click',closeCallbackModal);$('.callback-modal-overlay').on('click',function(e){if($(e.target).hasClass('callback-modal-overlay')){closeCallbackModal()}});$(document).on('keydown',function(e){if(e.key==='Escape'&&$('.callback-modal-overlay').hasClass('active')){closeCallbackModal()}});$('#callbackForm').on('submit',handleCallbackSubmit);$('#callback-phone').on('input',formatPhoneNumber);showFloatButtonOnScroll()}function openCallbackModal(){$('.callback-modal-overlay').addClass('active');$('body').css('overflow','hidden');setTimeout(function(){$('#callback-name').focus()},300)}function closeCallbackModal(){$('.callback-modal-overlay').removeClass('active');$('body').css('overflow','');setTimeout(function(){$('#callbackForm')[0].reset();$('.error-message').text('');$('.error').removeClass('error')},300)}function handleCallbackSubmit(e){e.preventDefault();const $form=$(this);const $button=$form.find('.submit-btn');if(!validateCallbackForm($form)){return}$button.addClass('loading').prop('disabled',true);const formData={action:'atk_ved_contact_form',nonce:atkVed.nonce,name:$form.find('[name="name"]').val(),phone:$form.find('[name="phone"]').val(),email:$form.find('[name="phone"]').val()+'@placeholder.com',message:'Запрос обратного звонка. Удобное время: '+$form.find('[name="time"] option:selected').text()};$.ajax({url:atkVed.ajaxUrl,type:'POST',data:formData,success:function(response){if(response.success){closeCallbackModal();alert('Спасибо! Мы перезвоним вам в течение 15 минут.')}else{alert('Произошла ошибка. Попробуйте позже или позвоните нам.')}},error:function(){alert('Ошибка соединения. Попробуйте позже.')},complete:function(){$button.removeClass('loading').prop('disabled',false)}})}function validateCallbackForm($form){let isValid=true;$form.find('.error-message').text('');$form.find('.error').removeClass('error');const $name=$form.find('[name="name"]');if($name.val().trim().length<2){showFieldError($name,'Введите корректное имя');isValid=false}const $phone=$form.find('[name="phone"]');const phoneValue=$phone.val().replace(/\D/g,'');if(phoneValue.length<11){showFieldError($phone,'Введите корректный номер телефона');isValid=false}const $privacy=$form.find('[name="privacy"]');if(!$privacy.is(':checked')){showFieldError($privacy,'Необходимо согласие с политикой');isValid=false}return isValid}function showFieldError($field,message){$field.addClass('error');$field.closest('.form-group').find('.error-message').text(message)}function formatPhoneNumber(){let value=$(this).val().replace(/\D/g,'');if(value.length>0){if(value[0]==='7'||value[0]==='8'){value='7'+value.substring(1)}let formatted='+7';if(value.length>1){formatted+=' ('+value.substring(1,4)}if(value.length>=5){formatted+=') '+value.substring(4,7)}if(value.length>=8){formatted+='-'+value.substring(7,9)}if(value.length>=10){formatted+='-'+value.substring(9,11)}$(this).val(formatted)}}function showFloatButtonOnScroll(){const $button=$('.callback-float-btn');$(window).on('scroll',function(){if($(this).scrollTop()>500){$button.fadeIn()}else{$button.fadeOut()}});$button.hide()}let currentSlide=0;let autoplayInterval;const autoplayDelay=5000;function initReviewsSlider(){const $reviewsSection=$('.reviews-section');if(!$reviewsSection.length)return;const $reviewsGrid=$reviewsSection.find('.reviews-grid');const $reviews=$reviewsGrid.find('.review-card');if($reviews.length===0)return;$reviewsGrid.addClass('reviews-slider');$reviews.each(function(index){$(this).attr('data-slide',index);if(index===0){$(this).addClass('active')}});const navigationHTML='<div class="slider-navigation"><button class="slider-btn slider-prev" aria-label="Предыдущий отзыв"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg></button><div class="slider-dots"></div><button class="slider-btn slider-next" aria-label="Следующий отзыв"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg></button></div>';$reviewsSection.find('.container').append(navigationHTML);const $dotsContainer=$('.slider-dots');$reviews.each(function(index){const dotHTML='<button class="slider-dot '+(index===0?'active':'')+'" data-slide="'+index+'" aria-label="Перейти к отзыву '+(index+1)+'"></button>';$dotsContainer.append(dotHTML)});$('.slider-prev').on('click',function(){stopAutoplay();prevSlide();startAutoplay()});$('.slider-next').on('click',function(){stopAutoplay();nextSlide();startAutoplay()});$('.slider-dot').on('click',function(){stopAutoplay();goToSlide($(this).data('slide'));startAutoplay()});let touchStartX=0;let touchEndX=0;$reviewsGrid.on('touchstart',function(e){touchStartX=e.touches[0].clientX});$reviewsGrid.on('touchend',function(e){touchEndX=e.changedTouches[0].clientX;handleSwipe()});function handleSwipe(){const swipeThreshold=50;const diff=touchStartX-touchEndX;if(Math.abs(diff)>swipeThreshold){stopAutoplay();if(diff>0){nextSlide()}else{prevSlide()}startAutoplay()}}$(document).on('keydown',function(e){if(!$reviewsSection.is(':visible'))return;if(e.key==='ArrowLeft'){stopAutoplay();prevSlide();startAutoplay()}else if(e.key==='ArrowRight'){stopAutoplay();nextSlide();startAutoplay()}});$reviewsGrid.on('mouseenter',stopAutoplay);$reviewsGrid.on('mouseleave',startAutoplay);startAutoplay()}function goToSlide(index){const $reviews=$('.review-card');const totalSlides=$reviews.length;if(index<0){currentSlide=totalSlides-1}else if(index>=totalSlides){currentSlide=0}else{currentSlide=index}$reviews.removeClass('active').eq(currentSlide).addClass('active');$('.slider-dot').removeClass('active').eq(currentSlide).addClass('active');updateSliderPosition()}function updateSliderPosition(){const $slider=$('.reviews-slider');const slideWidth=$('.review-card').outerWidth(true);const offset=-currentSlide*slideWidth;$slider.css('transform','translateX('+offset+'px)')}function nextSlide(){goToSlide(currentSlide+1)}function prevSlide(){goToSlide(currentSlide-1)}function startAutoplay(){stopAutoplay();autoplayInterval=setInterval(nextSlide,autoplayDelay)}function stopAutoplay(){if(autoplayInterval){clearInterval(autoplayInterval);autoplayInterval=null}}$(document).ready(function(){initCallbackModal();initReviewsSlider();let resizeTimer;$(window).on('resize',function(){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){updateSliderPosition()},250)})})})(jQuery);
