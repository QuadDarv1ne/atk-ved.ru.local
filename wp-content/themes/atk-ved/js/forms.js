/**
 * Form Handling with Background Sync
 * @package ATK_VED
 */
document.addEventListener('DOMContentLoaded',function(){const contactForms=document.querySelectorAll('.contact-form,.quick-search-form,#calculator-form');contactForms.forEach(function(form){form.addEventListener('submit',function(e){if(form.classList.contains('ajax-form')||form.classList.contains('contact-form')||form.classList.contains('newsletter-form')){return}e.preventDefault();const formData=new FormData(form);const serializedData=new URLSearchParams(formData).toString();fetch(form.action||'./',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:serializedData}).then(function(response){if(response.ok){return response.json()}throw new Error('Network response was not ok')}).then(function(data){if(data.queued){alert('Форма добавлена в очередь для отправки')}else{alert('Форма успешно отправлена')}form.reset()}).catch(function(error){console.error('Form submission error:',error);if('serviceWorker'in navigator&&'SyncManager'in window){navigator.serviceWorker.ready.then(function(reg){if(typeof localStorage!=='undefined'){const queuedForms=JSON.parse(localStorage.getItem('queued_forms')||'[]');queuedForms.push({id:Date.now(),url:form.action||'./',payload:serializedData,timestamp:Date.now()});localStorage.setItem('queued_forms',JSON.stringify(queuedForms))}reg.sync.register('contact-form-sync');alert('Форма будет отправлена при восстановлении соединения')})}})})})});
