/**
 * Web Vitals - Core Web Vitals мониторинг
 * @package ATK_VED
 */
(function(){'use strict';if(!('PerformanceObserver'in window))return;const sendMetric=(name,value)=>{if(typeof gtag!=='undefined'){gtag('event',name,{event_category:'Web Vitals',value:Math.round(value),non_interaction:true})}if(typeof ym!=='undefined'&&window.atkVed?.metrikaId){ym(window.atkVed.metrikaId,'reachGoal','web_vitals',{[name]:Math.round(value)})}};const observeLCP=()=>{const po=new PerformanceObserver(list=>{const entries=list.getEntries();const lastEntry=entries[entries.length-1];sendMetric('LCP',lastEntry.renderTime||lastEntry.loadTime)});po.observe({type:'largest-contentful-paint',buffered:true})};const observeFID=()=>{const po=new PerformanceObserver(list=>{const entries=list.getEntries();entries.forEach(entry=>sendMetric('FID',entry.processingStart-entry.startTime))});po.observe({type:'first-input',buffered:true})};const observeCLS=()=>{let clsValue=0;const po=new PerformanceObserver(list=>{list.getEntries().forEach(entry=>{if(!entry.hadRecentInput){clsValue+=entry.value}})});po.observe({type:'layout-shift',buffered:true});window.addEventListener('visibilitychange',()=>{if(document.visibilityState==='hidden'){sendMetric('CLS',clsValue)}},{once:true})};const observeTTFB=()=>{const nav=performance.getEntriesByType('navigation')[0];if(nav){sendMetric('TTFB',nav.responseStart)}};if(document.readyState==='complete'){observeLCP();observeFID();observeCLS();observeTTFB()}else{window.addEventListener('load',()=>{observeLCP();observeFID();observeCLS();observeTTFB()})}})();
