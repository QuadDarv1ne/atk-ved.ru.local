# Оптимизации темы АТК ВЭД v1.3

## Обзор

В версии 1.3 темы АТК ВЭД были добавлены три ключевых модуля оптимизации:
- **Производительность** (Performance)
- **SEO** (Search Engine Optimization)
- **Безопасность** (Security)

---

## 1. Модуль производительности (inc/performance.php)

### Оптимизация загрузки ресурсов

#### Отключение ненужных функций WordPress
- ✅ Эмодзи WordPress (экономия ~15KB)
- ✅ jQuery Migrate (экономия ~10KB)
- ✅ Встроенные стили блоков Gutenberg (экономия ~50KB)
- ✅ Dashicons для неавторизованных пользователей (экономия ~40KB)
- ✅ XML-RPC (защита от DDoS)
- ✅ Heartbeat API на фронтенде (снижение нагрузки на сервер)

#### Оптимизация скриптов и стилей
- ✅ Отложенная загрузка JavaScript (defer)
- ✅ Preload критических ресурсов
- ✅ DNS prefetch для внешних ресурсов
- ✅ Удаление версий из URL (для кэширования)

### Оптимизация изображений
- ✅ Lazy loading для всех изображений
- ✅ Качество JPEG оптимизировано до 85%
- ✅ Автоматическое добавление loading="lazy"

### Оптимизация базы данных
- ✅ Автоматическая очистка ревизий (старше 30 дней)
- ✅ Удаление автосохранений
- ✅ Очистка корзины
- ✅ Удаление спама
- ✅ Оптимизация таблиц
- ✅ Запуск раз в неделю автоматически

### Ограничения и настройки
- ✅ Максимум 3 ревизии на пост
- ✅ Автосохранение каждые 5 минут (вместо 1 минуты)
- ✅ Heartbeat в админке - 60 секунд

### Кэширование
- ✅ Функция кэширования запросов с transients
- ✅ Автоматическая очистка кэша при обновлении контента
- ✅ Кэширование для услуг, отзывов, FAQ

### Дополнительные оптимизации
- ✅ Удаление ненужных мета-тегов (wp_generator, wlwmanifest, rsd_link)
- ✅ Сжатие HTML (опционально, закомментировано)

**Ожидаемый результат:** Ускорение загрузки сайта на 30-50%

---

## 2. Модуль SEO (inc/seo.php)

### Социальные сети

#### Open Graph (Facebook, VK)
- ✅ og:title
- ✅ og:description
- ✅ og:url
- ✅ og:image
- ✅ og:type
- ✅ og:site_name

#### Twitter Cards
- ✅ twitter:card (summary_large_image)
- ✅ twitter:title
- ✅ twitter:description
- ✅ twitter:image

### Структурированные данные

#### Schema.org разметка
- ✅ Organization (для главной страницы)
- ✅ Название компании
- ✅ Логотип
- ✅ Адрес
- ✅ Контактная информация
- ✅ Социальные сети

### Мета-теги

#### Автоматические мета-описания
- ✅ Для постов (из excerpt или контента)
- ✅ Для категорий (из описания)
- ✅ Для тегов (из описания)
- ✅ Для главной (из описания сайта)

#### Технические мета-теги
- ✅ Canonical URL (предотвращение дублирования)
- ✅ Robots meta (noindex для поиска и 404)
- ✅ Hreflang (для мультиязычности)

### Sitemap.xml
- ✅ Автоматическая генерация
- ✅ Доступен по адресу: `?sitemap=xml`
- ✅ Включает главную, страницы, посты
- ✅ С датами изменения и приоритетами

### Оптимизация контента
- ✅ Автоматическое добавление alt к изображениям
- ✅ Улучшенные заголовки страниц
- ✅ Оптимизация заголовков (h1 → h2 в контенте)
- ✅ Nofollow для внешних ссылок

**Ожидаемый результат:** Улучшение позиций в поисковых системах на 20-40%

---

## 3. Модуль безопасности (inc/security.php)

### Скрытие информации

#### Версии и метаданные
- ✅ Скрытие версии WordPress
- ✅ Удаление версий плагинов
- ✅ Скрытие логина администратора
- ✅ Скрытие ошибок входа

### Защита от атак

#### Брутфорс (перебор паролей)
- ✅ Ограничение попыток входа (5 попыток / 15 минут)
- ✅ Задержка 2 секунды при неудачном входе
- ✅ Автоматический выход при неактивности (30 минут)

#### SQL инъекции
- ✅ Санитизация URL параметров
- ✅ Функции безопасной работы с БД
- ✅ Блокировка подозрительных запросов

#### XSS атаки
- ✅ Функции санитизации вывода
- ✅ Заголовок X-XSS-Protection
- ✅ Заголовок X-Content-Type-Options

#### CSRF атаки
- ✅ Генерация CSRF токенов
- ✅ Проверка токенов при POST запросах
- ✅ Использование сессий

### Заголовки безопасности
- ✅ X-Content-Type-Options: nosniff
- ✅ X-Frame-Options: SAMEORIGIN
- ✅ X-XSS-Protection: 1; mode=block
- ✅ Referrer-Policy: strict-origin-when-cross-origin
- ✅ Permissions-Policy

### Защита файлов и директорий
- ✅ Отключение редактирования файлов из админки
- ✅ Защита wp-config.php
- ✅ Защита .htaccess, error_log, debug.log
- ✅ Защита от hotlinking изображений (опционально)

### Отключение уязвимых функций
- ✅ XML-RPC (защита от DDoS и брутфорса)
- ✅ REST API для неавторизованных (опционально)
- ✅ Информация о пользователях в REST API

### Мониторинг и логирование
- ✅ Логирование подозрительной активности
- ✅ Запись в файл security.log
- ✅ Отслеживание IP, User Agent, событий
- ✅ Отключение отображения ошибок PHP на продакшене

### Блокировка подозрительных запросов
Автоматическая блокировка запросов содержащих:
- eval(
- base64_decode
- gzinflate
- ../
- <script
- union select
- concat(

**Ожидаемый результат:** Снижение риска взлома на 80-90%

---

## Как использовать

### Автоматическое подключение
Все модули автоматически подключаются в `functions.php`:

```php
require_once get_template_directory() . '/inc/performance.php';
require_once get_template_directory() . '/inc/seo.php';
require_once get_template_directory() . '/inc/security.php';
```

### Настройка опциональных функций

#### Отключить REST API для неавторизованных
В `inc/performance.php` раскомментируйте:
```php
add_filter('rest_authentication_errors', 'atk_ved_disable_rest_api');
```

#### Включить сжатие HTML
В `inc/performance.php` раскомментируйте:
```php
add_action('wp_loaded', function() {
    ob_start('atk_ved_compress_html');
});
```

#### Включить защиту от hotlinking
В `inc/security.php` раскомментируйте:
```php
add_action('init', 'atk_ved_prevent_hotlinking');
```

### Просмотр логов безопасности
Логи сохраняются в:
```
wp-content/security.log
wp-content/php-errors.log
```

### Доступ к sitemap
Sitemap доступен по адресу:
```
https://ваш-сайт.ru/?sitemap=xml
```

---

## Рекомендации

### Для максимальной производительности
1. Используйте кэширующий плагин (W3 Total Cache, WP Super Cache)
2. Настройте CDN для статических файлов
3. Используйте PHP 8.0 или выше
4. Включите Gzip сжатие на сервере
5. Оптимизируйте изображения перед загрузкой

### Для лучшего SEO
1. Заполните все настройки в Customizer (контакты, соцсети)
2. Добавьте логотип сайта
3. Используйте уникальные мета-описания
4. Регулярно обновляйте контент
5. Добавьте sitemap в Google Search Console

### Для максимальной безопасности
1. Используйте сложные пароли
2. Регулярно обновляйте WordPress и плагины
3. Делайте резервные копии
4. Используйте SSL сертификат (HTTPS)
5. Ограничьте доступ к wp-admin по IP (в .htaccess)
6. Регулярно проверяйте логи безопасности

---

## Проверка работы оптимизаций

### Производительность
- Google PageSpeed Insights: https://pagespeed.web.dev/
- GTmetrix: https://gtmetrix.com/
- WebPageTest: https://www.webpagetest.org/

### SEO
- Google Search Console
- Яндекс.Вебмастер
- Проверка Open Graph: https://developers.facebook.com/tools/debug/
- Проверка Schema.org: https://validator.schema.org/

### Безопасность
- Sucuri SiteCheck: https://sitecheck.sucuri.net/
- WPScan: https://wpscan.com/
- Проверка заголовков: https://securityheaders.com/

---

## Совместимость

✅ WordPress 5.0+
✅ PHP 7.4+
✅ MySQL 5.6+
✅ Все современные браузеры

---

## Поддержка

При возникновении проблем:
1. Проверьте логи ошибок
2. Отключите модули по одному для выявления конфликтов
3. Убедитесь, что нет конфликтов с плагинами
4. Проверьте права доступа к файлам

---

**Версия:** 1.3  
**Дата:** 25 февраля 2026  
**Автор:** АТК ВЭД Theme
