# Тестирование форм ATK VED

Этот каталог содержит тесты для проверки работы форм и функций безопасности темы.

## Доступные тесты

### 1. PHP тесты (test-forms.php)

Автоматические тесты для проверки серверной части форм.

**Запуск:**
```bash
php wp-content/themes/atk-ved/tests/test-forms.php
```

**Что тестируется:**
- ✓ Наличие обработчиков форм
- ✓ Регистрация AJAX хуков
- ✓ Rate limiting (ограничение попыток)
- ✓ Honeypot защита от спама
- ✓ Валидация безопасности (nonce)
- ✓ Валидация email адресов

**Ожидаемый результат:**
```
=== Тестирование форм ATK VED ===

Тест 1: Обработчик контактной формы...
  ✓ Функция atk_ved_handle_contact_form существует
  ✓ AJAX хук для авторизованных пользователей зарегистрирован
  ✓ AJAX хук для неавторизованных пользователей зарегистрирован

...

=== Результаты тестирования ===
Пройдено: 15
Провалено: 0
Всего: 15

✓ Все тесты пройдены успешно!
```

### 2. HTML тесты (test-forms.html)

Интерактивные тесты для проверки клиентской части форм.

**Запуск:**
1. Откройте файл в браузере: `http://ваш-сайт.ru/wp-content/themes/atk-ved/tests/test-forms.html`
2. Или скопируйте файл в корень сайта для удобства

**Что тестируется:**
- ✓ Отправка контактной формы
- ✓ Отправка формы подписки
- ✓ HTML5 валидация полей
- ✓ Email валидация
- ✓ Обязательные поля
- ✓ Наличие honeypot защиты

**Как использовать:**
1. Заполните формы и отправьте их
2. Проверьте сообщения об успехе/ошибке
3. Нажмите "Запустить тесты" для автоматической проверки

## Ручное тестирование

### Контактная форма

**Тест 1: Успешная отправка**
1. Заполните все обязательные поля (Имя, Телефон)
2. Нажмите "Отправить"
3. Ожидается: Сообщение "Спасибо! Мы свяжемся с вами в ближайшее время."

**Тест 2: Валидация**
1. Оставьте поля пустыми
2. Нажмите "Отправить"
3. Ожидается: Браузер покажет ошибки валидации

**Тест 3: Rate Limiting**
1. Отправьте форму 3 раза подряд
2. На 4-й попытке должно появиться: "Слишком много попыток. Попробуйте через 5 минут."

**Тест 4: Honeypot**
1. Откройте DevTools → Elements
2. Найдите скрытое поле `<input name="website">`
3. Заполните его любым значением
4. Отправьте форму
5. Ожидается: "Обнаружена подозрительная активность."

### Форма подписки

**Тест 1: Успешная подписка**
1. Введите валидный email
2. Нажмите "Подписаться"
3. Ожидается: "Спасибо за подписку! Проверьте почту для подтверждения."

**Тест 2: Дубликат email**
1. Подпишитесь с одним email
2. Попробуйте подписаться снова с тем же email
3. Ожидается: "Этот email уже подписан на рассылку"

**Тест 3: Невалидный email**
1. Введите "invalid-email"
2. Нажмите "Подписаться"
3. Ожидается: Браузер покажет ошибку валидации

## Проверка безопасности

### Security Headers

Проверьте заголовки безопасности с помощью curl:

```bash
curl -I http://ваш-сайт.ru
```

Должны присутствовать:
- `X-Content-Type-Options: nosniff`
- `X-Frame-Options: SAMEORIGIN`
- `X-XSS-Protection: 1; mode=block`
- `Referrer-Policy: strict-origin-when-cross-origin`
- `Content-Security-Policy: ...`
- `Permissions-Policy: ...`

### Логи безопасности

Проверьте файл логов:
```bash
tail -f wp-content/security.log
```

При подозрительной активности должны появляться записи:
```
[2024-01-15 10:30:45] IP: 127.0.0.1 | Event: honeypot_triggered | Details: Field: website, IP: 127.0.0.1 | User Agent: Mozilla/5.0...
[2024-01-15 10:31:20] IP: 127.0.0.1 | Event: rate_limit_exceeded | Details: Form: contact, IP: 127.0.0.1 | User Agent: Mozilla/5.0...
```

## Тестирование в разных браузерах

### Desktop
- [ ] Chrome (последняя версия)
- [ ] Firefox (последняя версия)
- [ ] Safari (последняя версия)
- [ ] Edge (последняя версия)

### Mobile
- [ ] Chrome Mobile (Android)
- [ ] Safari Mobile (iOS)
- [ ] Samsung Internet

### Что проверять:
1. Формы отправляются корректно
2. Валидация работает
3. Сообщения отображаются правильно
4. Нет ошибок в консоли
5. Анимации работают плавно

## Troubleshooting

### Тесты не проходят

**Проблема:** "Функция не найдена"
- Убедитесь, что файл `inc/contact-form.php` подключен в `module-loader.php`
- Проверьте, что файл `inc/helpers.php` загружен

**Проблема:** "AJAX хук не зарегистрирован"
- Проверьте, что в `contact-form.php` есть строки:
  ```php
  add_action('wp_ajax_atk_contact_form', 'atk_ved_handle_contact_form');
  add_action('wp_ajax_nopriv_atk_contact_form', 'atk_ved_handle_contact_form');
  ```

**Проблема:** "Rate limiting не работает"
- Проверьте, что transients работают (не отключены в wp-config.php)
- Очистите кэш WordPress

### Формы не отправляются

**Проблема:** "404 Not Found" при отправке
- Проверьте, что `ajaxUrl` правильно определен в JavaScript
- Убедитесь, что файл `admin-ajax.php` доступен

**Проблема:** "Ошибка безопасности"
- Проверьте, что nonce генерируется правильно
- Убедитесь, что nonce не истек (срок действия 24 часа)

**Проблема:** Письма не приходят
- Проверьте настройки SMTP
- Проверьте папку "Спам"
- Убедитесь, что `wp_mail()` работает корректно

## Дополнительные инструменты

### Онлайн проверка безопасности
- [Security Headers](https://securityheaders.com/)
- [Mozilla Observatory](https://observatory.mozilla.org/)
- [SSL Labs](https://www.ssllabs.com/ssltest/)

### Проверка производительности
- [Google PageSpeed Insights](https://pagespeed.web.dev/)
- [GTmetrix](https://gtmetrix.com/)
- [WebPageTest](https://www.webpagetest.org/)

### Проверка доступности
- [WAVE](https://wave.webaim.org/)
- [axe DevTools](https://www.deque.com/axe/devtools/)
- [Lighthouse](https://developers.google.com/web/tools/lighthouse)

## Автоматизация

Для автоматического запуска тестов при каждом коммите, добавьте в `.git/hooks/pre-commit`:

```bash
#!/bin/bash
php wp-content/themes/atk-ved/tests/test-forms.php
if [ $? -ne 0 ]; then
    echo "Тесты провалены. Коммит отменен."
    exit 1
fi
```

Сделайте файл исполняемым:
```bash
chmod +x .git/hooks/pre-commit
```

## Отчеты об ошибках

При обнаружении проблем создайте issue с информацией:
1. Описание проблемы
2. Шаги для воспроизведения
3. Ожидаемое поведение
4. Фактическое поведение
5. Скриншоты/логи
6. Версия браузера/ОС


---

## Тестирование доступности (Accessibility)

### PHP тесты (test-accessibility.php)

Автоматические тесты для проверки доступности сайта.

**Запуск:**
```bash
php wp-content/themes/atk-ved/tests/test-accessibility.php
```

**Что тестируется:**
- ✓ Изображения и alt атрибуты
- ✓ Формы и labels
- ✓ Структура заголовков (h1-h6)
- ✓ Описательность ссылок
- ✓ Семантические landmarks (header, nav, main, footer)
- ✓ Контрастность цветов
- ✓ Keyboard navigation
- ✓ ARIA атрибуты

**Ожидаемый результат:**
```
=== Тестирование доступности ATK VED ===

Тест 1: Изображения и alt атрибуты...
  ✓ Изображения с alt: 45/50 (90.0%)

Тест 2: Формы и labels...
  ✓ Поля с labels: 12/12 (100.0%)

...

=== Результаты тестирования ===
Пройдено: 18
Провалено: 2
Предупреждения: 3
Всего: 23

=== Рекомендации ===
1. Используйте WAVE для детальной проверки
2. Проверьте контрастность на WebAIM Contrast Checker
3. Протестируйте с screen reader
4. Проверьте keyboard navigation вручную
5. Запустите Lighthouse Accessibility audit
```

### HTML тесты (test-accessibility.html)

Интерактивный чек-лист для ручной проверки доступности.

**Запуск:**
Откройте файл в браузере: `http://ваш-сайт.ru/wp-content/themes/atk-ved/tests/test-accessibility.html`

**Возможности:**
- ✓ Интерактивный чек-лист проверок
- ✓ Отслеживание прогресса
- ✓ Тест клавиатурной навигации
- ✓ Ссылки на инструменты проверки
- ✓ Рекомендации по улучшению
- ✓ Сохранение прогресса в localStorage

## Ручное тестирование доступности

### 1. Проверка с клавиатуры

**Тест навигации Tab:**
1. Откройте главную страницу
2. Нажимайте Tab для перехода между элементами
3. Проверьте:
   - Все интерактивные элементы доступны
   - Порядок навигации логичен
   - Focus индикатор хорошо виден
   - Можно активировать элементы Enter/Space

**Тест навигации по меню:**
1. Нажмите Tab до меню навигации
2. Используйте стрелки для навигации по пунктам
3. Enter для открытия ссылки
4. Esc для закрытия подменю

### 2. Проверка со Screen Reader

**Windows (NVDA):**
1. Скачайте NVDA: https://www.nvaccess.org/
2. Запустите NVDA (Ctrl+Alt+N)
3. Откройте сайт
4. Используйте:
   - H - переход по заголовкам
   - K - переход по ссылкам
   - F - переход по формам
   - Insert+F7 - список элементов

**macOS (VoiceOver):**
1. Включите VoiceOver (Cmd+F5)
2. Откройте сайт в Safari
3. Используйте:
   - VO+Right/Left - навигация
   - VO+Space - активация
   - VO+U - список элементов

**Что проверять:**
- Screen reader читает весь контент
- Alt тексты изображений осмысленны
- Формы имеют понятные labels
- Ссылки описательны
- Структура страницы понятна

### 3. Проверка контрастности

**Инструменты:**
- WebAIM Contrast Checker: https://webaim.org/resources/contrastchecker/
- Chrome DevTools (Lighthouse)
- Contrast Ratio: https://contrast-ratio.com/

**Минимальные требования WCAG AA:**
- Обычный текст: 4.5:1
- Крупный текст (18pt+): 3:1
- UI компоненты: 3:1

**Как проверить:**
1. Откройте DevTools → Elements
2. Выберите элемент с текстом
3. В Styles найдите color и background-color
4. Проверьте контраст в Contrast Checker

### 4. Проверка изображений

**Чек-лист:**
- [ ] Все изображения имеют alt атрибут
- [ ] Alt текст описательный и осмысленный
- [ ] Декоративные изображения имеют alt=""
- [ ] Сложные изображения имеют longdesc или aria-describedby
- [ ] Иконки имеют aria-label или sr-only текст

**Как проверить:**
```javascript
// В консоли браузера
document.querySelectorAll('img:not([alt])').forEach(img => {
    console.log('Изображение без alt:', img.src);
});
```

### 5. Проверка форм

**Чек-лист:**
- [ ] Каждое поле имеет label
- [ ] Labels связаны с полями через for/id
- [ ] Обязательные поля помечены (required, aria-required)
- [ ] Ошибки валидации понятны и доступны
- [ ] Группы полей используют fieldset/legend

**Как проверить:**
```javascript
// В консоли браузера
document.querySelectorAll('input:not([type="hidden"]):not([type="submit"])').forEach(input => {
    const label = document.querySelector(`label[for="${input.id}"]`);
    if (!label && !input.getAttribute('aria-label')) {
        console.log('Поле без label:', input);
    }
});
```

## Инструменты автоматической проверки

### 1. Lighthouse (Chrome DevTools)

**Запуск:**
1. Откройте DevTools (F12)
2. Вкладка Lighthouse
3. Выберите "Accessibility"
4. Нажмите "Generate report"

**Целевые показатели:**
- Accessibility Score: > 90

### 2. WAVE Browser Extension

**Установка:**
- Chrome: https://chrome.google.com/webstore (поиск "WAVE")
- Firefox: https://addons.mozilla.org (поиск "WAVE")

**Использование:**
1. Откройте страницу
2. Нажмите на иконку WAVE
3. Просмотрите ошибки и предупреждения

### 3. axe DevTools

**Установка:**
- Chrome: https://chrome.google.com/webstore (поиск "axe DevTools")
- Firefox: https://addons.mozilla.org (поиск "axe DevTools")

**Использование:**
1. Откройте DevTools
2. Вкладка axe DevTools
3. Нажмите "Scan ALL of my page"

## Распространенные проблемы и решения

### Проблема: Изображения без alt

**Решение:**
```html
<!-- Плохо -->
<img src="logo.png">

<!-- Хорошо -->
<img src="logo.png" alt="Логотип АТК ВЭД">

<!-- Декоративное изображение -->
<img src="decoration.png" alt="">
```

### Проблема: Формы без labels

**Решение:**
```html
<!-- Плохо -->
<input type="text" placeholder="Имя">

<!-- Хорошо -->
<label for="name">Имя</label>
<input type="text" id="name" placeholder="Введите ваше имя">
```

### Проблема: Низкий контраст

**Решение:**
```css
/* Плохо - контраст 2.5:1 */
.text {
    color: #999;
    background: #fff;
}

/* Хорошо - контраст 7:1 */
.text {
    color: #333;
    background: #fff;
}
```

### Проблема: Ссылки без текста

**Решение:**
```html
<!-- Плохо -->
<a href="/about"><i class="icon-info"></i></a>

<!-- Хорошо -->
<a href="/about" aria-label="О компании">
    <i class="icon-info" aria-hidden="true"></i>
</a>
```

## Стандарты и рекомендации

### WCAG 2.1 Уровни соответствия

**Level A (минимальный):**
- Базовые требования доступности
- Критичные проблемы должны быть исправлены

**Level AA (рекомендуемый):**
- Стандарт для большинства сайтов
- Включает требования к контрасту 4.5:1

**Level AAA (максимальный):**
- Наивысший уровень доступности
- Контраст 7:1, расширенная поддержка

### Основные принципы WCAG

**1. Perceivable (Воспринимаемость):**
- Альтернативы для нетекстового контента
- Адаптируемый контент
- Различимый контент

**2. Operable (Управляемость):**
- Доступность с клавиатуры
- Достаточно времени
- Предотвращение приступов
- Навигация

**3. Understandable (Понятность):**
- Читаемый текст
- Предсказуемость
- Помощь при вводе

**4. Robust (Надежность):**
- Совместимость с assistive technologies
- Валидный код

## Чек-лист перед запуском

- [ ] Все изображения имеют alt атрибуты
- [ ] Все формы имеют labels
- [ ] Контрастность соответствует WCAG AA
- [ ] Сайт полностью доступен с клавиатуры
- [ ] Focus индикаторы видны
- [ ] Заголовки имеют правильную иерархию
- [ ] Ссылки описательны
- [ ] ARIA атрибуты используются корректно
- [ ] Протестировано со screen reader
- [ ] Lighthouse Accessibility > 90
- [ ] WAVE не показывает критичных ошибок
