# BEGIN MIME Types
<IfModule mod_mime.c>
    AddType text/css css
    AddType application/javascript js
    AddType image/svg+xml svg
    AddType font/woff2 woff2
    AddType font/woff woff
    AddType font/ttf ttf
    AddType font/otf otf
</IfModule>
# END MIME Types

# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>
# END WordPress

# BEGIN Performance - Caching
<IfModule mod_expires.c>
ExpiresActive On
ExpiresByType image/jpg "access plus 1 year"
ExpiresByType image/jpeg "access plus 1 year"
ExpiresByType image/gif "access plus 1 year"
ExpiresByType image/png "access plus 1 year"
ExpiresByType image/webp "access plus 1 year"
ExpiresByType image/svg+xml "access plus 1 year"
ExpiresByType text/css "access plus 1 month"
ExpiresByType application/javascript "access plus 1 month"
ExpiresByType application/x-javascript "access plus 1 month"
ExpiresByType application/font-woff "access plus 1 year"
ExpiresByType application/font-woff2 "access plus 1 year"
ExpiresByType font/woff "access plus 1 year"
ExpiresByType font/woff2 "access plus 1 year"
ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
ExpiresByType font/ttf "access plus 1 year"
ExpiresByType font/otf "access plus 1 year"
</IfModule>

<IfModule mod_headers.c>
<FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|ico|pdf|woff|woff2|ttf|otf|eot)$">
Header set Cache-Control "max-age=31536000, public, immutable"
</FilesMatch>
<FilesMatch "\.(css|js)$">
Header set Cache-Control "max-age=2592000, public"
</FilesMatch>
</IfModule>
# END Performance - Caching

# BEGIN Performance - GZIP
<IfModule mod_deflate.c>
AddOutputFilterByType DEFLATE text/html
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE text/javascript
AddOutputFilterByType DEFLATE text/xml
AddOutputFilterByType DEFLATE text/plain
AddOutputFilterByType DEFLATE application/javascript
AddOutputFilterByType DEFLATE application/x-javascript
AddOutputFilterByType DEFLATE application/json
AddOutputFilterByType DEFLATE application/xml
AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE application/rss+xml
AddOutputFilterByType DEFLATE application/atom_xml
AddOutputFilterByType DEFLATE image/svg+xml
AddOutputFilterByType DEFLATE font/ttf
AddOutputFilterByType DEFLATE font/otf
AddOutputFilterByType DEFLATE font/woff
AddOutputFilterByType DEFLATE font/woff2
</IfModule>
# END Performance - GZIP

# BEGIN Security - Security Headers
<IfModule mod_headers.c>
    # Защита от XSS атак
    Header set X-XSS-Protection "1; mode=block"
    
    # Защита от MIME-sniffing
    Header set X-Content-Type-Options "nosniff"
    
    # Защита от clickjacking
    Header set X-Frame-Options "SAMEORIGIN"
    
    # Referrer Policy
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Content Security Policy (временно упрощенная для отладки)
    # Header set Content-Security-Policy "default-src 'self' 'unsafe-inline' 'unsafe-eval' https:; img-src 'self' data: https: blob:; font-src 'self' data: https:;"
    
    # Permissions Policy (бывший Feature Policy)
    Header set Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=(), interest-cohort=()"
    
    # Удаление заголовка версии PHP
    Header unset X-Powered-By
    Header always unset X-Powered-By
    
    # Удаление заголовка версии сервера
    ServerSignature Off
    
    # HTTPS заголовки (раскомментировать при использовании HTTPS)
    # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # Дополнительная защита для загружаемых файлов
    <FilesMatch "\.(pdf|doc|docx|xls|xlsx|zip|rar)$">
        Header set X-Content-Type-Options "nosniff"
        Header set Content-Disposition "attachment"
    </FilesMatch>
</IfModule>
# END Security - Security Headers

# BEGIN Security - Block Access to Sensitive Files
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

<FilesMatch "(^#|#$|\.htaccess$|\.htpasswd$|wp-config\.php|readme\.html|license\.txt|xmlrpc\.php|install\.php|wp-admin/install\.php|wp-admin/setup-config\.php)">
    Require all denied
</FilesMatch>

# Explicit block for xmlrpc.php
<Files xmlrpc.php>
    Require all denied
</Files>

# Запрет доступа к директориям
<IfModule mod_alias.c>
    RedirectMatch 403 /\.git
    RedirectMatch 403 /\.svn
    RedirectMatch 403 /\.env
    RedirectMatch 403 /wp-content/upgrade
    RedirectMatch 403 /wp-content/cache
    # RedirectMatch 403 /wp-includes  # Закомментировано для работы WordPress
</IfModule>
# END Security - Block Access to Sensitive Files

# BEGIN Security - Block Bad Bots
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{HTTP_USER_AGENT} (ahrefs|semrush|mj12bot|dotbot|rogerbot|blexbot|linkdex|botvinnik|seokicks|sistrix|ltx71|angus|simplepie|feed|java|wget|curl|python|perl|ruby|scan) [NC]
    RewriteRule .* - [F,L]
</IfModule>
# END Security - Block Bad Bots

# BEGIN Security - Limit Request Methods
<LimitExcept GET POST HEAD>
    Require all denied
</LimitExcept>
# END Security - Limit Request Methods
